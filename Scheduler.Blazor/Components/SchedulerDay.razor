@using MudBlazor.Utilities
@typeparam T

<MudPaper Class="d-flex flex-column"
          Outlined="true"
          Elevation="0"
          Square="true">

    <SchedulerDayHeader Class="d-flex align-top pl-2" Date="Date"/>

    <MudButton DisableElevation="true"
               DisableRipple="true"
               FullWidth="true"
               Class="py-5 d-flex flex-grow-1"
               OnClick="@(async(e) => await Click(e))">

        <MudGrid>
            @{
                if (ScheduleView == EScheduleView.Calendar)
                {
                    var appointmentCount = 1;
                    foreach (var appointment in Appointments)
                    {
                        if (appointmentCount > MaxVisibleAppointments)
                        {
                            // Show more
                            <MudItem xs="12" Class="my-0">
                                <AppointmentSlot T="T"
                                                 Appointment="@appointment"
                                                 Class="rounded-0 d-flex"
                                                 Color="@Color"
                                                 OnClick="@OnAppointmentClick"
                                                 Variant="@AppointmentVariant">
                                    Show More + (@(Appointments.Count - MaxVisibleAppointments))
                                </AppointmentSlot>
                            </MudItem>

                            break;
                        }

                        <MudItem xs="12" Class="my-0">
                            <AppointmentSlot T="T"
                                             Appointment="@appointment"
                                             Class="rounded-0 d-flex"
                                             OnClick="@OnAppointmentClick"
                                             Variant="@AppointmentVariant">
                                @appointment.Title
                            </AppointmentSlot>
                        </MudItem>

                        appointmentCount++;
                    }
                }
                else
                {
                    if (AppointmentSpan.Minutes != 0)
                    {
                        <AppointmentGrid T="T"
                                         Appointments="@Appointments.ToList()"
                                         AppointmentSpan="@AppointmentSpan"
                                         OnAppointmentClick="@OnAppointmentClick"
                                         DayStartTime="@DayStartTime"
                                         DayEndTime="@DayEndTime"
                                         Date="@Date"/>
                    }
                }
            }
        </MudGrid>
    </MudButton>
</MudPaper>